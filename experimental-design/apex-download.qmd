# R script to download data from the apex logs and save it
#load the packages
```{r}
library(here)
library(tidyverse)
#get todays date
todaysdate <- format(Sys.Date(), format = "%y%m%d")
```

Parse todays date into the filename
```{r}
#Rack1url <- paste0('http://192.168.1.11/cgi-bin/datalog.xml?sdate=',todaysdate,'&days=3')
#Rack5url <- paste0('http://192.168.1.15/cgi-bin/datalog.xml?sdate=',todaysdate,'&days=3')
#Rack3url <- paste0('http://192.168.1.13/cgi-bin/datalog.xml?sdate=',todaysdate,'&days=3')
#Rack4url <- paste0('http://192.168.1.14/cgi-bin/datalog.xml?sdate=',todaysdate,'&days=3'
seatablesurl <- paste0('http://192.168.1.16/cgi-bin/datalog.xml?sdate=',todaysdate,'&days=3')
```

```{r}
here()
```


download the files - might have problems saving a xml as a csv

```{r}
#download.file(Rack1url, destfile = here(paste0(('raw-apex-xml files/Rack 1/'),'Rack 1_',todaysdate,'.xml')))
#download.file(Rack5url, destfile = here(paste0(('raw-apex-xml files/Rack 5/'),'Rack 5_',todaysdate,'.xml')))
#download.file(Rack3url, destfile = here(paste0(('raw-apex-xml files/Rack 3/'),'Rack 3_',todaysdate,'.xml')))
#download.file(Rack4url, destfile = here(paste0(('raw-apex-xml files/Rack 4/'),'Rack 4_',todaysdate,'.xml')))
download.file(seatablesurl, destfile = here(paste0(('experimental-design/raw-apex-xml/'),'seatables',todaysdate,'.xml')))
```

Data processing

# ##Filter only the data that I want
# select(hostname, date, name, type, value) %>% filter(type = 'Temp' | type == 'pH' | type == 'DO')
# #parse out the 
# pivot_wider %>% 

# #set the location to save these files 
# write_csv(dataLog, here(paste0(output.path,'/Apex_datalog_',file.date,'.csv')))
# write.csv(filenname, here(paste0('/Rack 1')))
# here('/Rack 1')
# 
# #Write the csvs heere
# write.csv(rack1, file = here(paste0(('Raw apex xml files/Rack 1/'),'Rack 1_',todaysdate,'.csv')))#this works
# write.csv(rack2, file = here(paste0(('Raw apex xml files/Rack 2/'),'Rack 2_',todaysdate,'.csv')))#this works
# write.csv(rack3, file = here(paste0(('Raw apex xml files/Rack 3/'),'Rack 3_',todaysdate,'.csv')))#this works
# write.csv(rack4, file = here(paste0(('Raw apex xml files/Rack 4/'),'Rack 4_',todaysdate,'.csv')))#this works
# #create the filenames I want for each file
# 
# outpath <- (here)
# 
# create a placeholder for the data that was run today 
# 
# download.file(url, destination)
# 
# 
# #get a
# #Save each rack datadile into a folder
# #download the data at midnight each day
# #need to change the dateand time
# 
# test <- here(paste0(('/Rack 1/'),'Rack 1_',todaysdate,'.csv'))
